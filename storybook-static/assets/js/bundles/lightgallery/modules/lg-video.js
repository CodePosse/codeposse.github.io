/*! For license information please see lg-video.js.LICENSE.txt */
!function(root,factory){"function"==typeof define&&define.amd?define(["jquery"],(function(a0){return factory(a0)})):"object"==typeof module&&module.exports?module.exports=factory(require("jquery")):factory(root.jQuery)}(this,(function($){!function(){"use strict";var defaults={videoMaxWidth:"855px",autoplayFirstVideo:!0,youtubePlayerParams:!1,vimeoPlayerParams:!1,dailymotionPlayerParams:!1,vkPlayerParams:!1,videojs:!1,videojsOptions:{}},Video=function(element){return this.core=$(element).data("lightGallery"),this.$el=$(element),this.core.s=$.extend({},defaults,this.core.s),this.videoLoaded=!1,this.init(),this};function onHasVideo(event,index,src,html){var _this=this;if(_this.core.$slide.eq(index).find(".lg-video").append(_this.loadVideo(src,"lg-object",!0,index,html)),html)if(_this.core.s.videojs)try{videojs(_this.core.$slide.eq(index).find(".lg-html5").get(0),_this.core.s.videojsOptions,(function(){!_this.videoLoaded&&_this.core.s.autoplayFirstVideo&&this.play()}))}catch(e){console.error("Make sure you have included videojs")}else!_this.videoLoaded&&_this.core.s.autoplayFirstVideo&&_this.core.$slide.eq(index).find(".lg-html5").get(0).play()}function onAferAppendSlide(event,index){var $videoCont=this.core.$slide.eq(index).find(".lg-video-cont");$videoCont.hasClass("lg-has-iframe")||($videoCont.css("max-width",this.core.s.videoMaxWidth),this.videoLoaded=!0)}function onBeforeSlide(event,prevIndex,index){var _src,$videoSlide=this.core.$slide.eq(prevIndex),youtubePlayer=$videoSlide.find(".lg-youtube").get(0),vimeoPlayer=$videoSlide.find(".lg-vimeo").get(0),dailymotionPlayer=$videoSlide.find(".lg-dailymotion").get(0),vkPlayer=$videoSlide.find(".lg-vk").get(0),html5Player=$videoSlide.find(".lg-html5").get(0);if(youtubePlayer)youtubePlayer.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");else if(vimeoPlayer)try{$f(vimeoPlayer).api("pause")}catch(e){console.error("Make sure you have included froogaloop2 js")}else if(dailymotionPlayer)dailymotionPlayer.contentWindow.postMessage("pause","*");else if(html5Player)if(this.core.s.videojs)try{videojs(html5Player).pause()}catch(e){console.error("Make sure you have included videojs")}else html5Player.pause();vkPlayer&&$(vkPlayer).attr("src",$(vkPlayer).attr("src").replace("&autoplay","&noplay")),_src=this.core.s.dynamic?this.core.s.dynamicEl[index].src:this.core.$items.eq(index).attr("href")||this.core.$items.eq(index).attr("data-src");var _isVideo=this.core.isVideo(_src,index)||{};(_isVideo.youtube||_isVideo.vimeo||_isVideo.dailymotion||_isVideo.vk)&&this.core.$outer.addClass("lg-hide-download")}Video.prototype.init=function(){var _this=this;_this.core.$el.on("hasVideo.lg.tm",onHasVideo.bind(this)),_this.core.$el.on("onAferAppendSlide.lg.tm",onAferAppendSlide.bind(this)),_this.core.doCss()&&_this.core.$items.length>1&&(_this.core.s.enableSwipe||_this.core.s.enableDrag)?_this.core.$el.on("onSlideClick.lg.tm",(function(){var $el=_this.core.$slide.eq(_this.core.index);_this.loadVideoOnclick($el)})):_this.core.$slide.on("click.lg",(function(){_this.loadVideoOnclick($(this))})),_this.core.$el.on("onBeforeSlide.lg.tm",onBeforeSlide.bind(this)),_this.core.$el.on("onAfterSlide.lg.tm",(function(event,prevIndex){_this.core.$slide.eq(prevIndex).removeClass("lg-video-playing")})),_this.core.s.autoplayFirstVideo&&_this.core.$el.on("onAferAppendSlide.lg.tm",(function(e,index){if(!_this.core.lGalleryOn){var $el=_this.core.$slide.eq(index);setTimeout((function(){_this.loadVideoOnclick($el)}),100)}}))},Video.prototype.loadVideo=function(src,addClass,noPoster,index,html){var video="",autoplay=1,a="",isVideo=this.core.isVideo(src,index)||{};if(noPoster&&(autoplay=this.videoLoaded?0:this.core.s.autoplayFirstVideo?1:0),isVideo.youtube)a="?wmode=opaque&autoplay="+autoplay+"&enablejsapi=1",this.core.s.youtubePlayerParams&&(a=a+"&"+$.param(this.core.s.youtubePlayerParams)),video='<iframe class="lg-video-object lg-youtube '+addClass+'" width="560" height="315" src="//www.youtube.com/embed/'+isVideo.youtube[1]+a+'" frameborder="0" allowfullscreen></iframe>';else if(isVideo.vimeo)a="?autoplay="+autoplay+"&api=1",this.core.s.vimeoPlayerParams&&(a=a+"&"+$.param(this.core.s.vimeoPlayerParams)),video='<iframe class="lg-video-object lg-vimeo '+addClass+'" width="560" height="315"  src="//player.vimeo.com/video/'+isVideo.vimeo[1]+a+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';else if(isVideo.dailymotion)a="?wmode=opaque&autoplay="+autoplay+"&api=postMessage",this.core.s.dailymotionPlayerParams&&(a=a+"&"+$.param(this.core.s.dailymotionPlayerParams)),video='<iframe class="lg-video-object lg-dailymotion '+addClass+'" width="560" height="315" src="//www.dailymotion.com/embed/video/'+isVideo.dailymotion[1]+a+'" frameborder="0" allowfullscreen></iframe>';else if(isVideo.html5){var fL=html.substring(0,1);"."!==fL&&"#"!==fL||(html=$(html).html()),video=html}else isVideo.vk&&(a="&autoplay="+autoplay,this.core.s.vkPlayerParams&&(a=a+"&"+$.param(this.core.s.vkPlayerParams)),video='<iframe class="lg-video-object lg-vk '+addClass+'" width="560" height="315" src="//vk.com/video_ext.php?'+isVideo.vk[1]+a+'" frameborder="0" allowfullscreen></iframe>');return video},Video.prototype.loadVideoOnclick=function($el){var _this=this;if($el.find(".lg-object").hasClass("lg-has-poster")&&$el.find(".lg-object").is(":visible"))if($el.hasClass("lg-has-video")){var youtubePlayer=$el.find(".lg-youtube").get(0),vimeoPlayer=$el.find(".lg-vimeo").get(0),dailymotionPlayer=$el.find(".lg-dailymotion").get(0),html5Player=$el.find(".lg-html5").get(0);if(youtubePlayer)youtubePlayer.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"*");else if(vimeoPlayer)try{$f(vimeoPlayer).api("play")}catch(e){console.error("Make sure you have included froogaloop2 js")}else if(dailymotionPlayer)dailymotionPlayer.contentWindow.postMessage("play","*");else if(html5Player)if(_this.core.s.videojs)try{videojs(html5Player).play()}catch(e){console.error("Make sure you have included videojs")}else html5Player.play();$el.addClass("lg-video-playing")}else{$el.addClass("lg-video-playing lg-has-video");var _loadVideo=function(_src,_html){if($el.find(".lg-video").append(_this.loadVideo(_src,"",!1,_this.core.index,_html)),_html)if(_this.core.s.videojs)try{videojs(_this.core.$slide.eq(_this.core.index).find(".lg-html5").get(0),_this.core.s.videojsOptions,(function(){this.play()}))}catch(e){console.error("Make sure you have included videojs")}else _this.core.$slide.eq(_this.core.index).find(".lg-html5").get(0).play()};_this.core.s.dynamic?_loadVideo(_this.core.s.dynamicEl[_this.core.index].src,_this.core.s.dynamicEl[_this.core.index].html):_loadVideo(_this.core.$items.eq(_this.core.index).attr("href")||_this.core.$items.eq(_this.core.index).attr("data-src"),_this.core.$items.eq(_this.core.index).attr("data-html"));var $tempImg=$el.find(".lg-object");$el.find(".lg-video").append($tempImg),$el.find(".lg-video-object").hasClass("lg-html5")||($el.removeClass("lg-complete"),$el.find(".lg-video-object").on("load.lg error.lg",(function(){$el.addClass("lg-complete")})))}},Video.prototype.destroy=function(){this.videoLoaded=!1},$.fn.lightGallery.modules.video=Video}()}));